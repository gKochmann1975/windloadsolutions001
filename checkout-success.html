<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="images/windloadcalc-favicon.svg">
    <title>Purchase Successful - WindLoadCalc</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .success-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 48px;
            text-align: center;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            animation: scaleIn 0.6s ease-out 0.2s both;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        .success-icon svg {
            width: 48px;
            height: 48px;
            stroke: white;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        h1 {
            color: #1e293b;
            font-size: 2rem;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .subtitle {
            color: #64748b;
            font-size: 1.1rem;
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .email-notice {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
            text-align: left;
        }

        .email-notice h2 {
            color: #0369a1;
            font-size: 1.2rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .email-notice h2 svg {
            width: 24px;
            height: 24px;
            stroke: #0369a1;
        }

        .email-notice p {
            color: #475569;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .email-notice strong {
            color: #0f172a;
        }

        .email-notice ul {
            margin: 16px 0;
            padding-left: 24px;
        }

        .email-notice li {
            color: #475569;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .next-steps {
            background: #fefce8;
            border: 2px solid #eab308;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            text-align: left;
        }

        .next-steps h3 {
            color: #854d0e;
            font-size: 1.1rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .next-steps h3 svg {
            width: 24px;
            height: 24px;
            fill: #854d0e;
        }

        .next-steps ol {
            margin: 0;
            padding-left: 24px;
        }

        .next-steps li {
            color: #713f12;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 200px;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0018ff 0%, #181E57 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 24, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 24, 255, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #0018ff;
            border: 2px solid #0018ff;
        }

        .btn-secondary:hover {
            background: #f8fafc;
            transform: translateY(-2px);
        }

        .help-text {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
            color: #64748b;
            font-size: 0.9rem;
        }

        .help-text a {
            color: #0018ff;
            text-decoration: none;
            font-weight: 600;
        }

        .help-text a:hover {
            text-decoration: underline;
        }

        @media (max-width: 640px) {
            .success-container {
                padding: 32px 24px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="success-container">
        <div class="success-icon">
            <svg viewBox="0 0 24 24" fill="none">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        </div>

        <h1>üéâ Purchase Successful!</h1>
        <p class="subtitle">Thank you for subscribing to WindLoadCalc. Your payment has been processed successfully.</p>

        <div class="email-notice">
            <h2>
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
                Check Your Email
            </h2>
            <p><strong>We've sent your login credentials to the email address you provided during checkout.</strong></p>
            <p>The email includes:</p>
            <ul>
                <li>Your temporary password</li>
                <li>Direct login link to access your calculators</li>
                <li>Instructions for getting started</li>
                <li>Support contact information</li>
            </ul>
            <p style="margin-top: 16px; padding: 12px; background: white; border-radius: 6px; font-size: 0.9rem;">
                <strong>‚è±Ô∏è Email should arrive within 1-2 minutes.</strong><br>
                Don't see it? Check your spam/junk folder or contact support.
            </p>
        </div>

        <div class="next-steps">
            <h3>
                <svg viewBox="0 0 24 24">
                    <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                    <path d="M9 12l2 2 4-4" fill="none" stroke="white" stroke-width="2"/>
                </svg>
                What's Next?
            </h3>
            <ol>
                <li><strong>Check your email</strong> for login credentials (arrives in 1-2 minutes)</li>
                <li><strong>Click the login link</strong> in the email or use the button below</li>
                <li><strong>Log in</strong> with the email and password we sent you</li>
                <li><strong>Start calculating</strong> wind loads immediately!</li>
            </ol>
        </div>

        <div class="button-group">
            <a href="building-intelligence-platform.html" class="btn btn-primary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                    <polyline points="10 17 15 12 10 7"></polyline>
                    <line x1="15" y1="12" x2="3" y2="12"></line>
                </svg>
                Go to Building Intelligence Platform
            </a>
            <a href="https://windloadcalc.com" class="btn btn-secondary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                Back to Website
            </a>
        </div>

        <div class="help-text">
            <p><strong>Need help?</strong></p>
            <p>Contact us at <a href="mailto:support@windloadcalc.com">support@windloadcalc.com</a></p>
            <p style="margin-top: 16px; font-size: 0.85rem; color: #94a3b8;">
                This purchase is covered by our 7-day money-back guarantee.<br>
                View our <a href="terms-of-service.html">Terms of Service</a> and <a href="privacy-policy.html">Privacy Policy</a>.
            </p>
        </div>
    </div>

    <script>
        const API_URL = 'https://api.windloadcalc.com';

        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');
        const email = urlParams.get('email');

        // Show personalized email if available
        if (email) {
            const subtitle = document.querySelector('.subtitle');
            subtitle.innerHTML = `Thank you for subscribing to WindLoadCalc. Your payment has been processed successfully.<br><br>An email with your login credentials has been sent to: <strong>${email}</strong>`;
        }

        // AUTO-LOGIN FLOW
        async function attemptAutoLogin() {
            if (!sessionId) {
                console.log('No session_id found in URL - auto-login not possible');
                return;
            }

            try {
                console.log('Attempting auto-login with session:', sessionId);

                // Show loading state
                const primaryBtn = document.querySelector('.btn-primary');
                const originalBtnText = primaryBtn.innerHTML;
                primaryBtn.innerHTML = '<span style="display: inline-block; animation: spin 1s linear infinite;">‚è≥</span> Preparing your account...';
                primaryBtn.style.pointerEvents = 'none';

                // Call backend to create auto-login token
                const response = await fetch(`${API_URL}/api/auth/auto-login-token`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        email: email // Optional verification
                    })
                });

                const data = await response.json();

                if (data.success && data.redirect_url) {
                    console.log('‚úÖ Auto-login successful! Redirecting to:', data.redirect_url);

                    // Update UI to show redirect
                    primaryBtn.innerHTML = '‚úÖ Success! Redirecting...';

                    // Show which platform they're going to
                    const subtitle = document.querySelector('.subtitle');
                    if (data.has_bip) {
                        subtitle.innerHTML += '<br><br><strong style="color: #10b981;">üöÄ Taking you to Building Intelligence Platform...</strong>';
                    } else if (data.has_calculator) {
                        subtitle.innerHTML += '<br><br><strong style="color: #10b981;">üöÄ Taking you to Wind Load Calculators...</strong>';
                    }

                    // Redirect after 2 seconds
                    setTimeout(() => {
                        window.location.href = data.redirect_url;
                    }, 2000);

                } else {
                    throw new Error(data.error || 'Auto-login failed');
                }

            } catch (error) {
                console.error('Auto-login error:', error);
                console.log('Falling back to manual login flow');

                // Reset button to manual login
                const primaryBtn = document.querySelector('.btn-primary');
                primaryBtn.innerHTML = originalBtnText;
                primaryBtn.style.pointerEvents = 'auto';

                // Show notice that they need to check email
                const emailNotice = document.querySelector('.email-notice');
                emailNotice.style.borderColor = '#f59e0b';
                emailNotice.style.background = '#fffbeb';

                const emailHeader = emailNotice.querySelector('h2');
                emailHeader.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    ‚ö†Ô∏è Please Check Your Email
                `;
            }
        }

        // Attempt auto-login after page loads
        window.addEventListener('DOMContentLoaded', () => {
            // Temporarily disable auto-login - just show manual login button
            console.log('Auto-login temporarily disabled - please use manual login');
            // attemptAutoLogin();
        });

        // Fallback: Auto-refresh page after 5 minutes to prevent stale sessions
        setTimeout(() => {
            window.location.reload();
        }, 300000); // 5 minutes

        // Add spinning animation for loading state
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
